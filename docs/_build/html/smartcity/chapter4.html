

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8. Chapter 4: Cloud Control micro:bit by IFTTT &mdash; Smarthon Documentation 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="9. Chapter 5: Object to Object communication" href="chapter5.html" />
    <link rel="prev" title="7. Chapter 3: Direct Control micro:bit by App Inventor 2" href="chapter3.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Smarthon Smart City IoT Starter Kit</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1_Introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_IOTbit.html">2. IoT:bit Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="3_getstart.html">3. Getting started: Add the extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="4_wificonnect.html">4. First step: Connect the micro:bit to the Wi-Fi</a></li>
<li class="toctree-l2"><a class="reference internal" href="chapter1.html">5. Chapter 1: Upload Data to ThingSpeak</a></li>
<li class="toctree-l2"><a class="reference internal" href="chapter2.html">6. Chapter 2: Send Email by IFTTT</a></li>
<li class="toctree-l2"><a class="reference internal" href="chapter3.html">7. Chapter 3: Direct Control micro:bit by App Inventor 2</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">8. Chapter 4: Cloud Control micro:bit by IFTTT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">8.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scenario-example">8.2. Scenario Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#part-1-coding">8.3. Part 1: Coding</a></li>
<li class="toctree-l3"><a class="reference internal" href="#part-2-ifttt-applet-configuration">8.4. Part 2: IFTTT Applet Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#result">8.5. Result</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="chapter5.html">9. Chapter 5: Object to Object communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="case01.html">10. Case 01: Automated Smart Playground Lamp</a></li>
<li class="toctree-l2"><a class="reference internal" href="case02.html">11. Case 02: Smart Car park Access Barrier</a></li>
<li class="toctree-l2"><a class="reference internal" href="case03.html">12. Case 03: Garbage disposal system</a></li>
<li class="toctree-l2"><a class="reference internal" href="case04.html">13. Case 04: Urban noise detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="case05.html">14. Case 05: Car speed monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="case06.html">15. IoT Case 06: Weather Station</a></li>
<li class="toctree-l2"><a class="reference internal" href="case07.html">16. IoT Case 07: Smart defense system</a></li>
<li class="toctree-l2"><a class="reference internal" href="case08.html">17. IoT Case 08: Automated Traffic Light</a></li>
<li class="toctree-l2"><a class="reference internal" href="case09.html">18. IoT Case 09: Smart House door control</a></li>
<li class="toctree-l2"><a class="reference internal" href="case10.html">19. IoT Case 10: Smart Street Light</a></li>
<li class="toctree-l2"><a class="reference internal" href="case11.html">20. IoT Case 11: Roof garden clothes rack</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../smarthouse/index.html">Smarthon Smart House Kit for micro:bit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../smartplant/index.html">Smarthon Plant Kit for micro:bit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Sensors_and_actuators/index.html">Sensors and actuators</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Smarthon Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Smarthon Smart City IoT Starter Kit</a> &raquo;</li>
        
      <li><span class="section-number">8. </span>Chapter 4: Cloud Control micro:bit by IFTTT</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/smartcity/chapter4.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="chapter-4-cloud-control-micro-bit-by-ifttt">
<h1><span class="section-number">8. </span>Chapter 4: Cloud Control micro:bit by IFTTT<a class="headerlink" href="#chapter-4-cloud-control-micro-bit-by-ifttt" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2><span class="section-number">8.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In this chapter, you will know how to control micro:bit from the IFTTT cloud. Once there are some changes on Internet services like weather, time or different connected devices like voice assistant and some smart home device, you can send the command to micro:bit to do the action. <BR><P></p>
<p><img alt="auto_fit" src="../_images/Ch4_2_intro.png" /><P></p>
<p>In practice, the below example you may apply for:</p>
<ul class="simple">
<li><p>Turn the street light on at 6pm and off after 6am everyday</p></li>
<li><p>Turn on the water pump every day at 06:00 for 2 second</p></li>
<li><p>If the forecast weather is rain, open the umbrella</p></li>
<li><p>Use voice command to control robot actions</p></li>
<li><p>When the door is closed, LED is turned on.</p></li>
</ul>
</div>
<div class="section" id="scenario-example">
<h2><span class="section-number">8.2. </span>Scenario Example<a class="headerlink" href="#scenario-example" title="Permalink to this headline">¶</a></h2>
<HR>
<span id="subtitle">Goal:</span> <P><p>The micro:bit is connected to the Internet. Once the time is changed to 6 pm, the IFTTT cloud will send the command to the micro:bit to turn on the LED.<P></p>
<p><span id="subtitle">Description:</span><P></p>
<p>In this example, there are 2 parts involved.</p>
<ul class="simple">
<li><p>In part 1, we need to connect the micro:bit to the internet and get the device ID.</p></li>
<li><p>In part 2, set the rule on IFTTT applet. If the time is 6 pm, set the command “light_on”</p></li>
</ul>
<p><img alt="auto_fit" src="../_images/Ch4_2_ifttt0.png" /><P></p>
</div>
<div class="section" id="part-1-coding">
<h2><span class="section-number">8.3. </span>Part 1: Coding<a class="headerlink" href="#part-1-coding" title="Permalink to this headline">¶</a></h2>
<HR><p><span id="subtitle" >Goal:</span><P>
We need to get the Device ID and set the corresponding action.<BR><P></p>
<p><span id="subtitle" >Connection Diagram:</span><BR></p>
<ul class="simple">
<li><p>Connect LED to P0<BR><P>
<img alt="auto_fit" src="../_images/Ch4_2_hardware.png" /><P></p></li>
</ul>
<p><span id="subtitle" >Step 1: Connect WiFi</span><BR><P>
Before we try to use WiFi Control function, we need to connect to the network, we have already know how to connect to the WiFi on the first chapter.<P>
<img alt="auto_fit" src="../_images/Ch4_2_p1.png" /><P></p>
<p><span id="subtitle" >Step 2: Get Device ID</span><BR><P>
<code class="docutils literal notranslate"><span class="pre">On</span> <span class="pre">WiFi</span> <span class="pre">connected</span></code> is an event handler. It will be triggered once after connected with WiFi. The handler will provide the <code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">ID</span></code> variable which used to identify and control the Microbit.</p>
<ul class="simple">
<li><p>Go to OLED Tab</p></li>
<li><p>Snap <code class="docutils literal notranslate"><span class="pre">initialize</span> <span class="pre">OLED</span> <span class="pre">with</span> <span class="pre">width…height..</span></code> to <code class="docutils literal notranslate"><span class="pre">on</span> <span class="pre">start</span></code></p></li>
<li><p>Snap the <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">string</span></code> inside the <code class="docutils literal notranslate"><span class="pre">On</span> <span class="pre">WiFi</span> <span class="pre">connected</span></code></p></li>
<li><p>Draw the <code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">ID</span></code> variable from <code class="docutils literal notranslate"><span class="pre">On</span> <span class="pre">WiFi</span> <span class="pre">connected</span></code> to the <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">tring</span></code> block placeholder</p></li>
</ul>
<p><img alt="auto_fit" src="../_images/Ch4_2_p2.png" /><P></p>
<p>*If you worried about forget the <code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">ID</span></code> during program running, you may access it by the variable under Control tab</p>
<ul class="simple">
<li><p>Go to Control tab</p></li>
<li><p>Snap the <code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">ID</span></code> variable to the placeholder
<img alt="auto_fit" src="../_images/Ch4_2_p2_1.png" /><P></p></li>
</ul>
<p><span id="subtitle" >Step 3: Control with Command</span><BR><P></p>
<p>After connected to the WiFI, the connection to the server will be done automatically, it is ready to receive command though network. To get the command, we can use the <code class="docutils literal notranslate"><span class="pre">on</span> <span class="pre">Wi-Fi</span> <span class="pre">received</span></code> handler in WAN control tab.</p>
<ul class="simple">
<li><p>Snap the <code class="docutils literal notranslate"><span class="pre">on</span> <span class="pre">WiFi</span> <span class="pre">received</span></code> handler to stage</p></li>
<li><p>Do the <code class="docutils literal notranslate"><span class="pre">if-condition</span> <span class="pre">statement</span></code> to the variable <code class="docutils literal notranslate"><span class="pre">WAN_Command</span></code></p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Wan_command</span></code> “light_on” is received, white LED will be turned on (intensity:1023)</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Wan_command</span></code> “light_off” is received, white LED will be turned off (intensity:0)</p></li>
</ul>
<p>Attention: Please be aware that the <strong>P</strong> is in capital letter.</p>
<p><img alt="auto_fit" src="../_images/Ch4_2_p3.png" /><P></p>
<p><span id="subtitle">Step 4: Show the Command</span><BR><P>
Sometimes you may need to show the recevied command for debugging, so if you need that, you can use the OLED <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">string</span></code> to display the command on the OLED.</p>
<ul class="simple">
<li><p>Go to OLED</p></li>
<li><p>Snap the <code class="docutils literal notranslate"><span class="pre">clear</span> <span class="pre">OLED</span> <span class="pre">display</span></code> to <code class="docutils literal notranslate"><span class="pre">On</span> <span class="pre">WiFi</span> <span class="pre">received</span></code> to avoid overlap</p></li>
<li><p>Snap the <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">string</span></code> to <code class="docutils literal notranslate"><span class="pre">On</span> <span class="pre">WiFi</span> <span class="pre">received</span></code></p></li>
<li><p>Draw the <code class="docutils literal notranslate"><span class="pre">WAN_Command</span></code> variable to <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">string</span></code> placeholder</p></li>
</ul>
<p><img alt="auto_fit" src="../_images/Ch4_2_p3_05.png" /><P></p>
<p><H3><U>Advanced Usage(with value):</U></H3></p>
<p>If you want to control the module with value, you can use the another block which contain <code class="docutils literal notranslate"><span class="pre">value</span></code> variable.<BR>
If <code class="docutils literal notranslate"><span class="pre">Wan</span> <span class="pre">command</span></code> “LightValue” is received, white LED will be turned on with the given intensity <code class="docutils literal notranslate"><span class="pre">value</span></code>.<BR>
You may also show the <code class="docutils literal notranslate"><span class="pre">WAN_Command</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code> by <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">string</span></code>.<P>
<img alt="auto_fit" src="../_images/Ch4_2_p3_1.png" /><P></p>
<p><span id="subtitle">Full Solution<BR><P>
MakeCode: <a class="reference external" href="https://makecode.microbit.org/#pub:_JmF1kVKaThzv">https://makecode.microbit.org/_JmF1kVKaThzv</a><BR><P>
You could also download the program from the following website:<BR></p>
<iframe src="https://makecode.microbit.org/#pub:_JmF1kVKaThzv" width="100%" height="500" frameborder="0"></iframe><P></div>
<div class="section" id="part-2-ifttt-applet-configuration">
<h2><span class="section-number">8.4. </span>Part 2: IFTTT Applet Configuration<a class="headerlink" href="#part-2-ifttt-applet-configuration" title="Permalink to this headline">¶</a></h2>
<HR><p><H3>Goal:</H3>
We need to setup the IFTTT Applet to control the Mircobit</p>
<p><span id="subtitle" >Step 1: Create or login to IFTTT account</span><P>
Open your browser , go to <a class="reference external" href="https://ifttt.com/">https://ifttt.com/</a>. Register your IFTTT account and once completed, log in to your IFTTT account.<BR><P>
<img alt="auto_fit" src="../_images/Ch4_ifttt1.png" /><P></p>
<p><span id="subtitle" >Step 2: Create Applets</span><BR><P>
On the top right menu, click “Create” &gt; “Applets”<BR><P>
<img alt="auto_fit" src="../_images/Ch4_ifttt2.png" /><P></p>
<p><span id="subtitle" >Step 3: Set the Rules</span><BR><P>
On IFTTT configuration, set the below. We can set the rule on the IFTTT, if something happened like time at 6:00 p.m., we can do the corresponding action.<P></p>
<p><img alt="auto_fit" src="../_images/Ch4_2_ifttt1.png" /><P></p>
<p><span id="subtitle" ><u>A. Trigger Part</u></span><P>
<img alt="auto_fit" src="../_images/Ch4_2_ifttt1_1.png" /><P>
1.Search “Date” and select “Date &amp; Time”<P>
<img alt="auto_fit" src="../_images/Ch4_2_ifttt1_2.png" /><P>
2.Finish the time setting.<P></p>
<ul class="simple">
<li><p>Choose trigger “Every day at”</p></li>
<li><p>Select the time (e.g. 06PM, 00Minutes; it menas every day at 6pm) and click “Create trigger”</p></li>
</ul>
<p><img alt="auto_fit" src="../_images/Ch4_2_ifttt1_3.png" /><P></p>
<p><span id="subtitle" ><u>B. Action Part</u></span><P></p>
<p><img alt="auto_fit" src="../_images/Ch4_2_ifttt1_4.png" /><P>
1.Search “micro:bit” and you will see “Smarthon IoT(micro:bit)”<P>
<img alt="auto_fit" src="../_images/Ch4_2_ifttt1_6.png" /><P></p>
<p>2.Finish the mirco:bit setting.</p>
<ul class="simple">
<li><p>Choose action “Control Command”</p></li>
<li><p>Input your <code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">ID</span></code> (e.g. 0xa3240ac45916) and <code class="docutils literal notranslate"><span class="pre">control</span> <span class="pre">command</span></code> (e.g. light_on). Then click “Create action”
<img alt="auto_fit" src="../_images/Ch4_2_ifttt1_7.png" /><P></p></li>
</ul>
<p><span id="subtitle" ><u>Optional</u></span><P>
If you need to send the command with value to the micro:bit<BR></p>
<p><img alt="auto_fit" src="../_images/Ch4_2_ifttt1_8.png" /><P></p>
</div>
<div class="section" id="result">
<h2><span class="section-number">8.5. </span>Result<a class="headerlink" href="#result" title="Permalink to this headline">¶</a></h2>
<HR><p><H3><U>Normal Case:</U></H3></p>
<p>After connected to WiFi, micro:bit will connect to control server and keep listening to the WAN command</p>
<ul class="simple">
<li><p>Every day at 6pm, clock will trigger IFTTT to send out micro:bit WAN command “light_On”</p></li>
<li><p>Micro:bit will recevie the command</p></li>
<li><p>The LED on P0 will be turned on.
<img alt="auto_fit" src="../_images/Ch4_2_result.png" /><P></p></li>
</ul>
<p><H3><U>Advanced Usage(with value):</U></H3></p>
<p>When change the applet to contain value version, it will have an additional variable <code class="docutils literal notranslate"><span class="pre">value</span></code> included</p>
<ul class="simple">
<li><p>Every day at 6pm, clock will trigger IFTTT to send out micro:bit WAN command “LightValue” (with value “600”)</p></li>
<li><p>Micro:bit will recevie the command</p></li>
<li><p>The LED on P0 will be turned on (with light intensity: 600).
<img alt="auto_fit" src="../_images/Ch4_2_result_1.png" /><P></p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="chapter5.html" class="btn btn-neutral float-right" title="9. Chapter 5: Object to Object communication" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="chapter3.html" class="btn btn-neutral float-left" title="7. Chapter 3: Direct Control micro:bit by App Inventor 2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Smarthon Limited

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>