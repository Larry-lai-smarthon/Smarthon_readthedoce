

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7. Chapter 3: Direct Control micro:bit by App Inventor 2 &mdash; Smarthon Documentation 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8. Chapter 4: Cloud Control micro:bit by IFTTT" href="chapter4.html" />
    <link rel="prev" title="6. Chapter 2: Send Email by IFTTT" href="chapter2.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Smarthon Smart City IoT Starter Kit</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1_Introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_IOTbit.html">2. IoT:bit Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="3_getstart.html">3. Getting started: Add the extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="4_wificonnect.html">4. First step: Connect the micro:bit to the Wi-Fi</a></li>
<li class="toctree-l2"><a class="reference internal" href="chapter1.html">5. Chapter 1: Upload Data to ThingSpeak</a></li>
<li class="toctree-l2"><a class="reference internal" href="chapter2.html">6. Chapter 2: Send Email by IFTTT</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">7. Chapter 3: Direct Control micro:bit by App Inventor 2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">7.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#know-the-api-control-command">7.2. Know the API (control command)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scenario-example">7.3. Scenario Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#part-1-coding">7.4. Part 1: Coding</a></li>
<li class="toctree-l3"><a class="reference internal" href="#part-2-app-inventor-2-configuration">7.5. Part 2: App Inventor 2 configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#result">7.6. Result</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="chapter4.html">8. Chapter 4: Cloud Control micro:bit by IFTTT</a></li>
<li class="toctree-l2"><a class="reference internal" href="chapter5.html">9. Chapter 5: Object to Object communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="case01.html">10. Case 01: Automated Smart Playground Lamp</a></li>
<li class="toctree-l2"><a class="reference internal" href="case02.html">11. Case 02: Smart Car park Access Barrier</a></li>
<li class="toctree-l2"><a class="reference internal" href="case03.html">12. Case 03: Garbage disposal system</a></li>
<li class="toctree-l2"><a class="reference internal" href="case04.html">13. Case 04: Urban noise detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="case05.html">14. Case 05: Car speed monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="case06.html">15. IoT Case 06: Weather Station</a></li>
<li class="toctree-l2"><a class="reference internal" href="case07.html">16. IoT Case 07: Smart defense system</a></li>
<li class="toctree-l2"><a class="reference internal" href="case08.html">17. IoT Case 08: Automated Traffic Light</a></li>
<li class="toctree-l2"><a class="reference internal" href="case09.html">18. IoT Case 09: Smart House door control</a></li>
<li class="toctree-l2"><a class="reference internal" href="case10.html">19. IoT Case 10: Smart Street Light</a></li>
<li class="toctree-l2"><a class="reference internal" href="case11.html">20. IoT Case 11: Roof garden clothes rack</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../smarthouse/index.html">Smarthon Smart House Kit for micro:bit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../smartplant/index.html">Smarthon Plant Kit for micro:bit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Sensors_and_actuators/index.html">Sensors and actuators</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Smarthon Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Smarthon Smart City IoT Starter Kit</a> &raquo;</li>
        
      <li><span class="section-number">7. </span>Chapter 3: Direct Control micro:bit by App Inventor 2</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/smartcity/chapter3.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="chapter-3-direct-control-micro-bit-by-app-inventor-2">
<h1><span class="section-number">7. </span>Chapter 3: Direct Control micro:bit by App Inventor 2<a class="headerlink" href="#chapter-3-direct-control-micro-bit-by-app-inventor-2" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2><span class="section-number">7.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>App inventor 2 is a blocks-based programming tool, which help beginners to build fully functional app in Android device. The interface is graphical base and support drag and drop operations. It consists of different components, such as button, slider, date pickers, image, camera, sensors including Accelerometer and connectivity to web, etc. The app can be exported or published to Play store for our daily life.<BR><P></p>
<p><img alt="auto_fit" src="../_images/Ch3_des1.png" /><P>
For creating IoT application, you can use App Inventor 2 to create web connection with micro:bit. In WAN control, after micro:bit is connected to internet, it keep listening and execute customized operation when WAN command is received. The customized operation could be Pin On/off, such as “open/close LED”, or set value such as “set the light intensity” and “set current time”.<BR><P></p>
<p><img alt="auto_fit" src="../_images/Ch3_des2.png" /><P></p>
</div>
<div class="section" id="know-the-api-control-command">
<h2><span class="section-number">7.2. </span>Know the API (control command)<a class="headerlink" href="#know-the-api-control-command" title="Permalink to this headline">¶</a></h2>
<HR><p>What is API? API is one way to communicate between the objects in the Internet world. API is just like an “URL” which is website link. <P>
In App inventor, we use “API” to communicate with micro:bit. Normally, we need to know the (1) device ID (2) the message need to be sent to the micro:bit and optionally (3) value if needed.</p>
<p><img alt="auto_fit" src="../_images/Ch3_des3.png" /></p>
<P><p><B><u>(1) Basic API:</u></B></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>https://control.smarthon.cc/publish?id=DeviceID&amp;msg=ControlCommand
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">id</span></code>: The unique ID of device, used to identify the target .<BR>
<code class="docutils literal notranslate"><span class="pre">msg</span></code>: The command needs to send.<P>
Example: “https://control.smarthon.cc/publish?id=0x123456781&amp;msg=lighton”.
In this case, we send the msg command “lighton” to device id “0x123456781”.<P></p>
<p><B><u>(2) Advanced API:</u></B></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>https://control.smarthon.cc/publish?id=DeviceID&amp;msg=ControlCommand&amp;value=Value
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">id</span></code>: The unique ID of device, used to identify the target .<BR>
<code class="docutils literal notranslate"><span class="pre">msg</span></code>: The command needs to send.<BR>
<code class="docutils literal notranslate"><span class="pre">value</span></code>(optional): Used when need for the command.<P>
Example: “https://control.smarthon.cc/publish?id=0x123456781&amp;msg=lighton&amp;value=500” .
In this case, we send the msg command “lighton” with intensity value “500” to device id “0x123456781”.<P></p>
</div>
<div class="section" id="scenario-example">
<h2><span class="section-number">7.3. </span>Scenario Example<a class="headerlink" href="#scenario-example" title="Permalink to this headline">¶</a></h2>
<HR>
<span id="subtitle">Goal:</span><P><p>This example is to turn on/off micro:bit LED by using app inventor 2.<BR></p>
<p><span id="subtitle">Description: </span><P></p>
<p>In this example, there are 2 parts involved. <P></p>
<ul class="simple">
<li><p>In part 1, we need to connect the micro:bit to the internet and get the device ID.</p></li>
<li><p>In part 2, design the mobile app and set the API with the device ID from part 1.</p></li>
</ul>
<P><p><img alt="auto_fit" src="../_images/Ch3_des4.png" /><P></p>
</div>
<div class="section" id="part-1-coding">
<h2><span class="section-number">7.4. </span>Part 1: Coding<a class="headerlink" href="#part-1-coding" title="Permalink to this headline">¶</a></h2>
<HR><p><span id="subtitle">Goal:</span><P>
We need to get the Device ID and set the corresponding action.<BR><P></p>
<p><span id="subtitle">Connection Diagram:</span><br></p>
<ul class="simple">
<li><p>Connect LED to P0<BR></p></li>
</ul>
<p><img alt="auto_fit" src="../_images/Ch3_hardware.png" /><P></p>
<p><span id="subtitle">Step 1: Connect WiFI</span><BR><P>
Before we try to use WiFi Control function, we need to connect to the network, we have already know how to connect to the WiFi on the first chapter.
<BR><P>
<img alt="auto_fit" src="../_images/Ch3_p1.png" /><P></p>
<p><span id="subtitle">Step 2: Get Device ID</span><BR><P>
<code class="docutils literal notranslate"><span class="pre">On</span> <span class="pre">WiFi</span> <span class="pre">connected</span></code> is an event handler.
It will be triggered once after connected with WiFi.
The handler will provide the <code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">ID</span></code> variable which used to identify and control the Microbit.<BR></p>
<ul class="simple">
<li><p>Go to OLED Tab</p></li>
<li><p>Snap <code class="docutils literal notranslate"><span class="pre">initialize</span> <span class="pre">OLED</span> <span class="pre">with</span> <span class="pre">width…height..</span></code> to <code class="docutils literal notranslate"><span class="pre">on</span> <span class="pre">start</span></code></p></li>
<li><p>Snap the <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">string</span></code> inside the <code class="docutils literal notranslate"><span class="pre">On</span> <span class="pre">WiFi</span> <span class="pre">connected</span></code></p></li>
<li><p>Draw the <code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">ID</span></code> variable from <code class="docutils literal notranslate"><span class="pre">On</span> <span class="pre">WiFi</span> <span class="pre">connected</span></code> to the <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">tring</span></code> block placeholder</p></li>
</ul>
<p><img alt="auto_fit" src="../_images/Ch3_p2.png" /><P></p>
<p>*If you worried about forget the <code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">ID</span></code> during program running, you may access it by the variable under Control tab<P></p>
<ul class="simple">
<li><p>Go to Control tab</p></li>
<li><p>Snap the <code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">ID</span></code> variable to the placeholder<P></p></li>
</ul>
<p><img alt="auto_fit" src="../_images/Ch3_p2_1.png" /><P></p>
<p><span id="subtitle">Step 3: Control with Command</span><BR><P>
After connected to the WiFI, the connection to the server will be done automatically, it is ready to receive command though network.
To get the command, we can use the <code class="docutils literal notranslate"><span class="pre">on</span> <span class="pre">Wi-Fi</span> <span class="pre">received</span></code> handler in WAN control tab.<BR></p>
<ul class="simple">
<li><p>Snap the <code class="docutils literal notranslate"><span class="pre">on</span> <span class="pre">WiFi</span> <span class="pre">received</span></code> handler to stage</p></li>
<li><p>Do the <code class="docutils literal notranslate"><span class="pre">if-condition</span> <span class="pre">statement</span></code> to the variable <code class="docutils literal notranslate"><span class="pre">WAN_Command</span></code></p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Wan_command</span></code> “Pin_On” is received, white LED will be turned on (intensity:1023)</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Wan_command</span></code> “Pin_Off” is received, white LED will be turned off (intensity:0)<BR></p></li>
</ul>
<p>Attention: Please be aware that the <strong>P</strong> is in capital letter.</p>
<P><p><img alt="auto_fit" src="../_images/Ch3_p3.png" /><P></p>
<p><span id="subtitle">Step 4: Show the Command</span><BR><P>
Sometimes you may need to show the recevied command for debugging, so if you need that, you can use the OLED <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">string</span></code> to display the command on the OLED.</p>
<ul class="simple">
<li><p>Go to OLED</p></li>
<li><p>Snap the <code class="docutils literal notranslate"><span class="pre">clear</span> <span class="pre">OLED</span> <span class="pre">display</span></code> to <code class="docutils literal notranslate"><span class="pre">On</span> <span class="pre">WiFi</span> <span class="pre">received</span></code> to avoid overlap</p></li>
<li><p>Snap the <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">string</span></code> to <code class="docutils literal notranslate"><span class="pre">On</span> <span class="pre">WiFi</span> <span class="pre">received</span></code></p></li>
<li><p>Draw the <code class="docutils literal notranslate"><span class="pre">WAN_Command</span></code> variable to <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">string</span></code> placeholder</p></li>
</ul>
<p><img alt="auto_fit" src="../_images/Ch3_p3_1.png" /><P></p>
<p><span id="subtitle"><u>Advanced Usage: Command with value</u></span><BR><P>
If you want to control the module with value, you can use the another block which contain <code class="docutils literal notranslate"><span class="pre">value</span></code> variable.<BR>
If <code class="docutils literal notranslate"><span class="pre">Wan</span> <span class="pre">command</span></code> “PinValue” is received, white LED will be turned on with the given intensity <code class="docutils literal notranslate"><span class="pre">value</span></code>.
<BR>
You may also show the <code class="docutils literal notranslate"><span class="pre">WAN_Command</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code> by <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">string</span></code>.<P>
<img alt="auto_fit" src="../_images/Ch3_p4.png" /><P></p>
<p><span id="subtitle">Full Solution<BR><P>
MakeCode: <a class="reference external" href="https://makecode.microbit.org/#pub:_bMFRmFYP2fdv">https://makecode.microbit.org/_bMFRmFYP2fdv</a><BR><P>
You could also download the program from the following website:<BR></p>
<iframe src="https://makecode.microbit.org/#pub:_bMFRmFYP2fdv" width="100%" height="500" frameborder="0"></iframe><P></div>
<div class="section" id="part-2-app-inventor-2-configuration">
<h2><span class="section-number">7.5. </span>Part 2: App Inventor 2 configuration<a class="headerlink" href="#part-2-app-inventor-2-configuration" title="Permalink to this headline">¶</a></h2>
<HR><p><H3>Goal:</H3>
We need to create mobile app to control the IoT:bit by using API. <P></p>
<p><span id="subtitle">Step 1: Create Layout</span><BR><P>
Create a new project in App Inventor 2, on “Designer”<BR></p>
<ul class="simple">
<li><p>Drag “Layout”&gt;”HorizontalArragement” to the page.</p></li>
<li><p>Drag “User Interface” &gt; “Button” twice to the place inside the HorizontalArrangement</p></li>
<li><p>Drag Connectivity&gt; “Web” to the page
<img alt="auto_fit" src="../_images/Ch3_app1.png" /><P></p></li>
</ul>
<p><span id="subtitle">Step 2: Define Function</span><BR><P>
Set the program in app inventor 2, on “Blocks” <BR></p>
<ul class="simple">
<li><p>Take the block as below
<img alt="auto_fit" src="../_images/Ch3_app2.png" /><P></p></li>
<li><p>When Button 1 and 2 is pressed, it calls the WAN control API respectively
http://control.smarthon.cc/publish?id=<code class="docutils literal notranslate"><span class="pre">DeviceID</span></code>&amp;msg=<code class="docutils literal notranslate"><span class="pre">ControlCommand</span></code></p></li>
</ul>
<p><img alt="auto_fit" src="../_images/Ch3_app3.png" /><P></p>
<p><H3><u>Advanced Usage: Control with value</u></H3>
If you want to control the module with value, you can create in textbox with the button let the user to input the value.<P></p>
<p><B>Layout:</B><BR>
<img alt="auto_fit" src="../_images/Ch3_app3_1.png" /><P></p>
<p><B>Programming:</B><P>
When Button 3 is pressed, it calls the WAN control API respectively
http://control.smarthon.cc/publish?id=<code class="docutils literal notranslate"><span class="pre">0xfa240ac45917</span></code>&amp;msg=<code class="docutils literal notranslate"><span class="pre">PinValue</span></code>&amp;value=<code class="docutils literal notranslate"><span class="pre">600</span></code><BR></p>
<p><img alt="auto_fit" src="../_images/Ch3_app3_2.png" /><P></p>
<p><span id="subtitle">Step 3: Build the apps</span><BR><P>
Build and test the mobile app. <BR>
In App Inventor 2, you can perform real-time testing in your mobile phone by AI Companion<BR></p>
<p><img alt="auto_fit" src="../_images/Ch3_app4.png" /><P></p>
<p>Also, you can also build and download the android app and open it in your mobile phone.<P></p>
<p><img alt="auto_fit" src="../_images/Ch3_app4_1.png" /><P></p>
</div>
<div class="section" id="result">
<h2><span class="section-number">7.6. </span>Result<a class="headerlink" href="#result" title="Permalink to this headline">¶</a></h2>
<HR><p>After the WiFI Connected, the Device ID will show<P></p>
<p><img alt="auto_fit" src="../_images/Ch3_result1.png" /><P></p>
<p><U><B>Normal Case:</B></U><BR>
When Button1 is clicked, it will send WAN command “Pin_On” to the micro:bit with provided Device ID, the LED on P0 will be turned on. When button 2 is clicked, the LED will be turned off.<P></p>
<p><img alt="auto_fit" src="../_images/Ch3_result2.png" /><P></p>
<p><U><B>Control the value(advanced):</B></U><BR>
When the button 3 is pressed with the intensity of 0 or 600, it will be turned on accordingly.<P></p>
<p><img alt="auto_fit" src="../_images/Ch3_result3.png" /><P></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="chapter4.html" class="btn btn-neutral float-right" title="8. Chapter 4: Cloud Control micro:bit by IFTTT" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="chapter2.html" class="btn btn-neutral float-left" title="6. Chapter 2: Send Email by IFTTT" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Smarthon Limited

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>